import React, { useEffect, useContext  } from 'react';
import { Link } from 'react-router-dom';

import { CustomerContext } from '../App';
import CustomerCreate from '../components/CustomerCreate';
import Header1 from '../components/styled/Header1';
import Header4 from '../components/styled/Header4';
import Me from '../components/Me'
import Container from '../components/styled/Container';
import ContainerMe from '../components/styled/ContainerMe';
import ContainerCreate from '../components/styled/ContainerCreate';
import ContainerList from '../components/styled/ContainerList';

export default function HomePage() {
    const { customerList, setCustomerList } = useContext(CustomerContext)

    useEffect(() => {
        fetchData()
    }, [])

    function fetchData() {
        const url = 'https://frebi.willandskill.eu/api/v1/customers/'
        const token = localStorage.getItem('webb21-kursuppgift-js3')
        fetch(url, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            }
        })
        .then(res => res.json())
            .then(data => {
            //console.log(data.results)
            return setCustomerList(data.results);
        })
    }

    return (
        <div>
            <div className='row'>
                <Header1 text='Home page' />
            </div>
            <div className='row'>
                <div className='col-md-3'>
                    <Header4 text='Logged in as' />
                    <ContainerMe>
                        <Me />
                    </ContainerMe> 
                </div>
                <div className='col-md-9'>
                    <Header4 text='Your current client-list' />
                    <Container col={10}>
                        <ContainerCreate>
                            <CustomerCreate onSuccess={fetchData} />
                        </ContainerCreate>
                        <ContainerList>
                            {customerList && customerList.map((item, index) => {
                                return (
                                    <div key={item.id}>
                                        <h4 key={index}> <Link to={`customers/${item.id}`}>{item.name}</Link> </h4>
                                    </div>
                                )
                            })}
                        </ContainerList>
                    </Container>
                </div>
            </div>
        </div>
    )
}