import React, { useState, useEffect, useContext } from 'react';
import { useNavigate, useParams } from 'react-router-dom';
import { CustomerContext } from '../App';
import ContainerDetail from '../components/styled/ContainerDetail';
import Header1 from '../components/styled/Header1';
import PrimaryButton from '../components/styled/PrimaryButton';

export default function CustomerDetailPage(props) {
    const [detail, setDetail] = useState(null)
    const { customerList } = useContext(CustomerContext)
    const navigate = useNavigate()

    const params = useParams()
    const id = params.id

    useEffect(() => {
        const url = `https://frebi.willandskill.eu/api/v1/customers/${id}`
        const token = localStorage.getItem('webb21-kursuppgift-js3')
        fetch(url, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            }
        })
        .then(res => res.json())
        .then(data => {
            setDetail(data.results)
            //console.log(detail)
        })
    }, [])

    function handleOnDelete(id) {
        //console.log(id)
        const url = `https://frebi.willandskill.eu/api/v1/customers/${id}/`
        const token = localStorage.getItem('webb21-kursuppgift-js3')
        fetch(url, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            }
        })
        .then(res => res.json())
        .then(data => props.fetchData(data))
        navigate('/home')
    }

    //console.log(customerList)
    const customer = customerList.find(customer => customer.id === parseInt(id))

    return (
        <div>
            {customerList && (
                <>
                    <ContainerDetail>
                        <Header1 text={customer.name} />

                        <p>E-Mail: {customer.email}</p>
                        <p>Phone number: {customer.phoneNumber}</p>
                        <p>Website: <a href="#">{customer.website}</a></p>
                        <p>Organization Nr: {customer.orgNr}</p>
                        <p>Vat Nr: {customer.vatNr}</p>
                        <p>reference: {customer.reference}</p>
                        <p>payment term: {customer.paymentTerm}</p>
                        {/* <button onClick={(e) => handleOnDelete(id)}>Delete client</button> */}
                        <PrimaryButton onClick={(e) => handleOnDelete(id)}>Delete client</PrimaryButton>
                    </ContainerDetail>
                </>    
            )}
        </div>
    )
}
